<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <title>Elite Pro | Intelligence Mission Control</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        :root { --gold: #D4AF37; --obsidian: #0a0a0a; }
        body { background-color: var(--obsidian); color: #e5e5e5; font-family: 'Inter', sans-serif; overflow-x: hidden; }
        .gold-gradient { background: linear-gradient(135deg, #D4AF37 0%, #F9E272 50%, #B8860B 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .glass-card { background: rgba(255, 255, 255, 0.02); border: 1px solid rgba(212, 175, 55, 0.15); border-radius: 1.5rem; transition: all 0.3s ease; }
        .skill-bar { height: 6px; background: rgba(255,255,255,0.05); border-radius: 3px; overflow: hidden; }
        .skill-fill { height: 100%; background: linear-gradient(90deg, #B8860B, #D4AF37); transition: width 1.5s cubic-bezier(0.1, 0, 0, 1); }
        .status-badge { background: rgba(212, 175, 55, 0.1); border: 1px solid var(--gold); color: var(--gold); padding: 4px 12px; border-radius: 20px; font-size: 10px; font-weight: 800; text-transform: uppercase; }
        .welcome-animate { animation: fadeInScale 0.8s ease-out; }
        @keyframes fadeInScale { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: scale(1); } }
    </style>
</head>
<body class="p-4 md:p-8">
    <div class="max-w-[1600px] mx-auto">
        <header class="flex flex-col lg:flex-row justify-between items-center mb-10 border-b border-white/5 pb-6 gap-4">
            <div>
                <h1 class="text-4xl font-black italic gold-gradient uppercase tracking-tighter">Elite<span class="text-white not-italic">Intelligence</span></h1>
                <p class="text-[10px] text-gray-500 uppercase font-bold tracking-[0.3em]">Season 2025-2026 | Mission Control</p>
            </div>
            <div class="flex flex-wrap justify-center gap-3">
                <select id="playerSelector" class="bg-black border border-yellow-700/50 text-yellow-500 py-2.5 px-8 rounded-full text-xs font-bold outline-none cursor-pointer shadow-2xl"></select>
            </div>
        </header>

        <div class="max-w-7xl mx-auto px-4 py-6">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-10">
                <div class="glass-card p-4 border-l-4 border-yellow-500 bg-white/[0.02]">
                    <p class="text-[9px] uppercase font-black text-gray-500 tracking-widest">Actieve Selectie</p>
                    <p class="text-xl font-black text-white" id="stat-team-display">Laden...</p>
                </div>
                <div class="glass-card p-4 border-l-4 border-blue-500 bg-white/[0.02]">
                    <p class="text-[9px] uppercase font-black text-gray-500 tracking-widest">Totaal Spelers</p>
                    <p class="text-xl font-black text-white" id="stat-total-display">--</p>
                </div>
                <div class="glass-card p-4 border-l-4 border-green-500 bg-white/[0.02]">
                    <p class="text-[9px] uppercase font-black text-gray-500 tracking-widest">Team Gemiddelde</p>
                    <p class="text-xl font-black text-white" id="stat-avg-display">-- <span class="text-[10px] text-green-400">‚Üë</span></p>
                </div>
                <div class="glass-card p-4 border-l-4 border-purple-500 bg-white/[0.02]">
                    <p class="text-[9px] uppercase font-black text-gray-500 tracking-widest">Systeem Status</p>
                    <p class="text-xl font-black text-white text-green-500 flex items-center gap-2">Online <span class="w-2 h-2 bg-green-500 rounded-full animate-pulse"></span></p>
                </div>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-12 gap-8 mb-12">
                <div class="lg:col-span-8 space-y-6">
                    <h3 class="text-[10px] font-black uppercase text-gray-500 tracking-[0.3em]">Operational Core</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <a href="planner.html" class="glass-card p-8 group hover:bg-blue-600/10 transition border-b-4 border-blue-600">
                            <div class="text-4xl mb-4 group-hover:scale-110 transition duration-300">üìÖ</div>
                            <h4 class="text-lg font-black text-white uppercase italic">Trainings Planner</h4>
                            <p class="text-xs text-gray-500 mt-2">Bereid je sessies voor en beheer de teamagenda.</p>
                        </a>
                        <a href="coach.html" class="glass-card p-8 group hover:bg-purple-600/10 transition border-b-4 border-purple-600">
                            <div class="text-4xl mb-4 group-hover:scale-110 transition duration-300">üß†</div>
                            <h4 class="text-lg font-black text-white uppercase italic">Coach Ratings</h4>
                            <p class="text-xs text-gray-500 mt-2">Directe spelerbeoordelingen na training of wedstrijd.</p>
                        </a>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mt-6">
                        <a href="overview.html" class="glass-card p-6 flex flex-col items-center text-center hover:bg-white/5 transition">
                            <span class="text-2xl mb-2">üìã</span>
                            <span class="text-[10px] font-black uppercase text-white">Squad List</span>
                        </a>
                        <a href="comparison.html" class="glass-card p-6 flex flex-col items-center text-center hover:bg-white/5 transition">
                            <span class="text-2xl mb-2">‚öñÔ∏è</span>
                            <span class="text-[10px] font-black uppercase text-white">Selection Matrix</span>
                        </a>
                        <a href="seasonal_analysis.html" class="glass-card p-6 flex flex-col items-center text-center hover:bg-white/5 transition">
                            <span class="text-2xl mb-2">üìä</span>
                            <span class="text-[10px] font-black uppercase text-white">Analytics</span>
                        </a>
                    </div>
                </div>

                <div class="lg:col-span-4 space-y-6">
                    <h3 class="text-[10px] font-black uppercase text-gray-500 tracking-[0.3em]">Management</h3>
                    <div class="glass-card p-6 space-y-4">
                        <div class="flex items-center gap-4 p-3 bg-white/5 rounded-xl border border-white/10">
                            <div id="user-initials" class="w-10 h-10 rounded-full bg-yellow-500/20 flex items-center justify-center text-yellow-500 font-bold">??</div>
                            <div>
                                <p class="text-[10px] font-black text-white uppercase leading-tight" id="user-name">Laden...</p>
                                <p class="text-[8px] text-gray-500 font-bold uppercase tracking-widest" id="user-role-display">Rol</p>
                            </div>
                        </div>
                        <div class="space-y-2">
                            <div id="adminLink" class="hidden">
                                <a href="admin_panel.html" class="flex items-center justify-between p-3 rounded-lg hover:bg-purple-500/10 text-gray-400 hover:text-purple-400 transition border border-transparent hover:border-purple-500/20">
                                    <span class="text-[10px] font-black uppercase">Admin Panel</span>
                                    <span>üõ†Ô∏è</span>
                                </a>
                            </div>
                            <button onclick="sessionStorage.clear(); window.location.href='login.html';" class="w-full flex items-center justify-between p-3 rounded-lg hover:bg-red-500/10 text-gray-400 hover:text-red-500 transition border border-transparent">
                                <span class="text-[10px] font-black uppercase">Systeem Uitloggen</span>
                                <span>üîí</span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="playerDossier" class="hidden welcome-animate">
            <div id="captureArea" class="bg-[#0a0a0a] p-8 rounded-[3rem] border border-white/10 shadow-2xl">
                <div class="grid grid-cols-1 xl:grid-cols-12 gap-8">
                    <div class="xl:col-span-3 space-y-6">
                        <div class="glass-card overflow-hidden relative group">
                            <img id="pPhoto" class="w-full h-[500px] object-cover bg-neutral-900 transition duration-700 group-hover:scale-110" src="" crossorigin="anonymous">
                            <div class="absolute inset-0 bg-gradient-to-t from-black via-black/20 to-transparent"></div>
                            <div class="absolute bottom-8 left-8">
                                <div id="pAllocation" class="status-badge mb-4 inline-block">Berekent...</div>
                                <h2 id="pName" class="text-5xl font-black uppercase italic text-white leading-none tracking-tighter"></h2>
                                <p id="pMeta" class="text-gray-400 text-[10px] font-bold mt-3 uppercase tracking-[0.3em]"></p>
                            </div>
                        </div>
                        <div class="glass-card p-6">
                            <h3 class="text-[10px] font-black text-gray-500 uppercase mb-6 tracking-widest text-center">Groeicurve</h3>
                            <canvas id="trendChart" height="200"></canvas>
                        </div>
                        <div class="glass-card p-8 flex flex-col items-center">
                            <canvas id="radarChart"></canvas>
                        </div>
                    </div>

                    <div class="xl:col-span-9 space-y-6">
                        <div class="grid grid-cols-2 lg:grid-cols-4 gap-4">
                            <div class="glass-card p-8 text-center border-b-4 border-yellow-600">
                                <p class="text-[10px] text-gray-500 uppercase font-black mb-2">Elite Index</p>
                                <div id="finalScore" class="text-6xl font-black text-white italic">0</div>
                            </div>
                            <div class="glass-card p-8 text-center border-b-4 border-blue-500">
                                <p class="text-[10px] text-gray-500 uppercase font-black mb-2">Opkomst</p>
                                <div id="attScore" class="text-6xl font-black text-white italic">0%</div>
                            </div>
                            <div class="glass-card p-8 text-center border-b-4 border-green-500">
                                <p class="text-[10px] text-gray-500 uppercase font-black mb-2">Minuten</p>
                                <div id="minScore" class="text-6xl font-black text-white italic">0</div>
                            </div>
                            <div class="glass-card p-8 text-center border-b-4 border-purple-500">
                                <p class="text-[10px] text-gray-500 uppercase font-black mb-2">Progressie</p>
                                <div id="growthVal" class="text-6xl font-black text-white italic">0</div>
                            </div>
                        </div>
                        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                            <div class="glass-card p-8"><h4 class="text-xs font-black text-yellow-500 uppercase mb-8 border-l-4 border-yellow-500 pl-4">Technical (65%)</h4><div id="techGrid" class="space-y-5"></div></div>
                            <div class="glass-card p-8"><h4 class="text-xs font-black text-blue-500 uppercase mb-8 border-l-4 border-blue-500 pl-4">Tactical / Physical</h4><div id="physGrid" class="space-y-5"></div></div>
                            <div class="glass-card p-8"><h4 class="text-xs font-black text-purple-500 uppercase mb-8 border-l-4 border-purple-500 pl-4">Mental / Team</h4><div id="mentGrid" class="space-y-5"></div></div>
                        </div>
                        <div class="glass-card p-10 border-2 border-yellow-600/30 bg-gradient-to-br from-yellow-600/10 via-transparent to-transparent">
                            <h3 class="text-2xl font-black text-white uppercase mb-8 italic tracking-tighter">Zomer-Roadmap 2026</h3>
                            <div class="grid grid-cols-1 lg:grid-cols-12 gap-10 items-center">
                                <div class="lg:col-span-4 bg-black/60 p-8 rounded-3xl border border-white/10">
                                    <label class="text-[10px] font-black text-yellow-500 uppercase mb-4 block">Primary Skill Target</label>
                                    <p id="focusSkill" class="text-4xl font-black text-white uppercase italic tracking-tighter">-</p>
                                </div>
                                <div class="lg:col-span-8">
                                    <p id="summerText" class="text-base text-gray-300 italic leading-relaxed font-light"></p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="mt-12 flex justify-center pb-12">
                <button id="downloadBtn" class="bg-gradient-to-r from-yellow-600 to-yellow-400 text-black font-black px-20 py-6 rounded-full text-[11px] uppercase tracking-[0.3em] hover:scale-105 transition shadow-2xl">Download Report</button>
            </div>
        </div>

        <div id="welcomeScreen" class="welcome-animate flex flex-col items-center justify-center min-h-[40vh] text-center">
            <div class="glass-card p-16 max-w-4xl border-2 border-yellow-600/20">
                <h2 class="text-6xl font-black italic text-white uppercase mb-6 tracking-tighter">Ready for <span class="text-yellow-500">Analysis?</span></h2>
                <p class="text-gray-400 text-lg mb-12 max-w-2xl mx-auto">Selecteer een speler in de terminal om de volledige dataset te laden.</p>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-8 border-t border-white/10 pt-10">
                    <div><p class="text-4xl font-black text-white" id="stat-total">0</p><p class="text-[10px] text-gray-500 uppercase font-bold">Geregistreerd</p></div>
                    <div class="border-x border-white/10"><p class="text-4xl font-black text-yellow-500" id="stat-avg">0%</p><p class="text-[10px] text-gray-500 uppercase font-bold">Elite Index</p></div>
                    <div><p class="text-4xl font-black text-green-500" id="stat-growth">0</p><p class="text-[10px] text-gray-500 uppercase font-bold">Top Grower</p></div>
                </div>
            </div>
        </div>
    </div>

    <script type="module">
        import DataProvider from './js/data_provider.js';

        const sessionUser = sessionStorage.getItem('elite_user');
        if (!sessionUser) window.location.href = 'login.html';
        const currentUser = JSON.parse(sessionUser);

        let chartRadar = null, chartTrend = null, filteredPlayers = [];

        const calcIndex = (p) => {
            if(!p.obj || !p.ratings) return 0;
            const obj = Math.round((p.obj.attendance * 0.4) + ((p.obj.minutes / 1500) * 100 * 0.6));
            const coach = Math.round((Object.values(p.ratings).reduce((a,b)=>parseInt(a)+parseInt(b),0)/(Object.keys(p.ratings).length*5))*100);
            const tech = p.stats?.Techniek || 50;
            return Math.round((obj * 0.65) + (tech * 0.20) + (coach * 0.15));
        };

        async function init() {
            const allPlayers = await DataProvider.getAllPlayers();
            if(!allPlayers.length) return;

            // User Info Inladen
            document.getElementById('user-name').innerText = currentUser.name;
            document.getElementById('user-role-display').innerText = currentUser.role;
            document.getElementById('user-initials').innerText = currentUser.name.split(' ').map(n => n[0]).join('');
            
            if (currentUser.role === 'admin') {
                document.getElementById('adminLink').classList.remove('hidden');
                filteredPlayers = allPlayers;
                document.getElementById('stat-team-display').innerText = "ALLE TEAMS";
            } else {
                filteredPlayers = allPlayers.filter(p => currentUser.teams.includes(p.bio.team));
                document.getElementById('stat-team-display').innerText = currentUser.teams[0] || "GEEN TEAM";
            }

            // Stats Vullen
            const totalCount = filteredPlayers.length;
            document.getElementById('stat-total').innerText = totalCount;
            document.getElementById('stat-total-display').innerText = totalCount;
            
            const avgVal = totalCount > 0 ? Math.round(filteredPlayers.reduce((acc, p) => acc + calcIndex(p), 0) / totalCount) : 0;
            document.getElementById('stat-avg').innerText = avgVal + "%";
            document.getElementById('stat-avg-display').innerText = avgVal + "%";

            // Selector
            const selector = document.getElementById('playerSelector');
            selector.innerHTML = '<option value="">SELECTEER SPELER...</option>' + 
                filteredPlayers.map(p => `<option value="${p.id}">${p.bio.name}</option>`).join('');

            selector.addEventListener('change', e => {
                if(e.target.value) {
                    document.getElementById('welcomeScreen').classList.add('hidden');
                    document.getElementById('playerDossier').classList.remove('hidden');
                    update(e.target.value);
                }
            });
        }

        const update = (id) => {
            const p = filteredPlayers.find(x => x.id === id);
            if(!p) return;
            document.getElementById('pName').innerText = p.bio.name;
            document.getElementById('pPhoto').src = p.bio.photo;
            document.getElementById('pMeta').innerText = `${p.bio.team} | ${p.bio.role}`;
            const idx = calcIndex(p);
            document.getElementById('finalScore').innerText = idx;
            document.getElementById('attScore').innerText = (p.obj?.attendance || 0) + "%";
            document.getElementById('minScore').innerText = p.obj?.minutes || 0;
            
            const r = p.ratings || {};
            const bar = (l, v) => `<div class="space-y-2"><div class="flex justify-between text-[9px] font-black uppercase"><span class="text-gray-500">${l}</span><span class="text-white">${v}/5</span></div><div class="skill-bar"><div class="skill-fill" style="width:${(v/5)*100}%"></div></div></div>`;
            document.getElementById('techGrid').innerHTML = bar("Balcontrole", r.bal) + bar("Passing", r.pas) + bar("Aanname", r.aan) + bar("Dribbel", r.drib);
            // ... overige grids ...
            
            renderRadar(p);
            renderTrend(p);
        };

        const renderRadar = (p) => {
            const ctx = document.getElementById('radarChart');
            if(chartRadar) chartRadar.destroy();
            chartRadar = new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: ['Techniek', 'Tactiek', 'Fysiek', 'Mentaal'],
                    datasets: [{ data: Object.values(p.stats), borderColor: '#D4AF37', backgroundColor: 'rgba(212,175,55,0.2)', borderWidth: 3 }]
                },
                options: { scales: { r: { suggestedMin: 0, suggestedMax: 100, ticks: {display:false} } }, plugins: { legend: { display: false } } }
            });
        };

        const renderTrend = (p) => {
            const ctx = document.getElementById('trendChart');
            if(chartTrend) chartTrend.destroy();
            chartTrend = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ["Start", "Winter", "Eind"],
                    datasets: [{ data: [65, 72, 80], borderColor: '#D4AF37', fill: true }]
                },
                options: { plugins: { legend: { display: false } } }
            });
        };

        init();
    </script>
</body>
</html>
