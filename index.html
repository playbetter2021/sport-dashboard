<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <title>Elite Pro | Intelligence Mission Control</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        :root { 
            --gold: #D4AF37; 
            --obsidian: #050505; 
            --card-bg: rgba(20, 20, 20, 0.7);
            --border-glow: rgba(212, 175, 55, 0.2);
        }

        body { 
            background-color: var(--obsidian); 
            background-image: radial-gradient(circle at top right, rgba(212, 175, 55, 0.03), transparent 600px);
            color: #e5e5e5; 
            font-family: 'Inter', sans-serif; 
            overflow-x: hidden; 
        }

        .gold-gradient { 
            background: linear-gradient(135deg, #D4AF37 0%, #F9E272 50%, #B8860B 100%); 
            -webkit-background-clip: text; 
            -webkit-text-fill-color: transparent; 
        }

        .glass-card { 
            background: var(--card-bg); 
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.03); 
            border-radius: 1.25rem; 
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            position: relative;
            overflow: hidden;
        }

        .glass-card:hover {
            transform: translateY(-4px);
            border-color: var(--border-glow);
            box-shadow: 0 20px 40px rgba(0,0,0,0.6), 0 0 20px rgba(212, 175, 55, 0.05);
        }

        .accent-line {
            position: absolute;
            left: 0;
            top: 25%;
            height: 50%;
            width: 3px;
            border-radius: 0 4px 4px 0;
        }

        .skill-bar { height: 6px; background: rgba(255,255,255,0.03); border-radius: 10px; overflow: hidden; }
        .skill-fill { height: 100%; background: linear-gradient(90deg, #B8860B, var(--gold)); transition: width 1.5s ease; }

        #playerSelector {
            background: rgba(10, 10, 10, 0.9);
            border: 1px solid rgba(212, 175, 55, 0.2);
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }

        .welcome-animate { animation: fadeInScale 0.6s ease-out; }
        @keyframes fadeInScale { from { opacity: 0; transform: scale(0.98); } to { opacity: 1; transform: scale(1); } }
    </style>
</head>
<body class="p-4 md:p-8">
    <div class="max-w-[1600px] mx-auto space-y-10">
        
        <header class="flex flex-col lg:flex-row justify-between items-center border-b border-white/5 pb-10 gap-6">
            <div>
                <h1 class="text-5xl font-black italic gold-gradient uppercase tracking-tighter leading-none">Elite<span class="text-white not-italic">Intelligence</span></h1>
                <p class="text-[10px] text-gray-500 uppercase font-bold tracking-[0.5em] mt-3">Intelligence Division ‚Ä¢ Mission Control</p>
            </div>
            
            <div class="relative w-full lg:w-96">
                <select id="playerSelector" class="w-full text-white py-4 px-10 rounded-2xl text-xs font-black outline-none appearance-none cursor-pointer focus:border-yellow-500 transition shadow-2xl">
                    <option value="">LADEN VAN TERMINAL...</option>
                </select>
                <span class="absolute right-6 top-1/2 -translate-y-1/2 text-yellow-500 pointer-events-none">‚ñº</span>
            </div>
        </header>

        <section class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
            <div class="glass-card p-6">
                <div class="accent-line bg-yellow-500"></div>
                <p class="text-[9px] uppercase font-black text-gray-500 tracking-widest mb-1">Active Assignment</p>
                <p class="text-3xl font-black text-white italic" id="stat-team-display">Laden...</p>
            </div>
            <div class="glass-card p-6">
                <div class="accent-line bg-blue-500"></div>
                <p class="text-[9px] uppercase font-black text-gray-500 tracking-widest mb-1">Total Assets</p>
                <p class="text-3xl font-black text-white italic" id="stat-total-display">--</p>
            </div>
            <div class="glass-card p-6">
                <div class="accent-line bg-green-500"></div>
                <p class="text-[9px] uppercase font-black text-gray-500 tracking-widest mb-1">Elite Index</p>
                <p class="text-3xl font-black text-white italic" id="stat-avg-display">--</p>
            </div>
            <div class="glass-card p-6">
                <div class="accent-line bg-purple-500"></div>
                <p class="text-[9px] uppercase font-black text-gray-500 tracking-widest mb-1">Status</p>
                <div class="flex items-center gap-2">
                    <p class="text-3xl font-black text-green-500 italic">SECURE</p>
                    <span class="w-3 h-3 bg-green-500 rounded-full animate-pulse"></span>
                </div>
            </div>
        </section>

        <div class="grid grid-cols-1 lg:grid-cols-12 gap-8">
            <main class="lg:col-span-8 space-y-8">
                
                <div id="welcomeScreen" class="welcome-animate">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <a href="planner.html" class="glass-card p-10 border-b-4 border-blue-600 group">
                            <span class="text-5xl block mb-6 group-hover:scale-110 transition duration-500">üìÖ</span>
                            <h4 class="text-xl font-black text-white uppercase italic tracking-tighter">Trainings Planner</h4>
                            <p class="text-xs text-gray-500 mt-2">Stel sessies samen en beheer de teamagenda.</p>
                        </a>
                        <a href="coach.html" class="glass-card p-10 border-b-4 border-purple-600 group">
                            <span class="text-5xl block mb-6 group-hover:scale-110 transition duration-500">üß†</span>
                            <h4 class="text-xl font-black text-white uppercase italic tracking-tighter">Coach Ratings</h4>
                            <p class="text-xs text-gray-500 mt-2">Verwerk spelerbeoordelingen direct na de actie.</p>
                        </a>
                    </div>
                    <div class="grid grid-cols-3 gap-4 mt-6">
                        <a href="overview.html" class="glass-card p-6 text-center hover:bg-white/5 transition">
                            <span class="block text-2xl mb-2">üìã</span>
                            <span class="text-[9px] font-black uppercase text-white tracking-widest">Squad Archive</span>
                        </a>
                        <a href="comparison.html" class="glass-card p-6 text-center hover:bg-white/5 transition">
                            <span class="block text-2xl mb-2">‚öñÔ∏è</span>
                            <span class="text-[9px] font-black uppercase text-white tracking-widest">Selection Matrix</span>
                        </a>
                        <a href="seasonal_analysis.html" class="glass-card p-6 text-center hover:bg-white/5 transition">
                            <span class="block text-2xl mb-2">üìä</span>
                            <span class="text-[9px] font-black uppercase text-white tracking-widest">Analysis</span>
                        </a>
                    </div>
                </div>

                <div id="playerDossier" class="hidden welcome-animate space-y-8">
                    <div id="captureArea" class="glass-card p-10 bg-[#050505]">
                        <div class="grid grid-cols-12 gap-10">
                            <div class="col-span-4 space-y-6">
                                <div class="rounded-3xl overflow-hidden border border-white/10 relative">
                                    <img id="pPhoto" class="w-full h-[500px] object-cover bg-neutral-900" src="">
                                    <div class="absolute inset-0 bg-gradient-to-t from-black via-transparent to-transparent"></div>
                                    <div class="absolute bottom-6 left-6">
                                        <h2 id="pName" class="text-4xl font-black uppercase italic text-white leading-none tracking-tighter"></h2>
                                        <p id="pMeta" class="text-[9px] text-yellow-500 font-bold mt-2 uppercase tracking-[0.3em]"></p>
                                    </div>
                                </div>
                                <div class="glass-card p-6 bg-white/[0.02]">
                                    <canvas id="trendChart" height="150"></canvas>
                                </div>
                            </div>
                            <div class="col-span-8 space-y-8">
                                <div class="grid grid-cols-3 gap-4">
                                    <div class="glass-card p-6 text-center border-b-2 border-yellow-500"><p class="text-[9px] text-gray-500 uppercase font-black mb-1">Elite Index</p><div id="finalScore" class="text-4xl font-black text-white italic">0</div></div>
                                    <div class="glass-card p-6 text-center border-b-2 border-blue-500"><p class="text-[9px] text-gray-500 uppercase font-black mb-1">Atten.</p><div id="attScore" class="text-4xl font-black text-white italic">0%</div></div>
                                    <div class="glass-card p-6 text-center border-b-2 border-green-500"><p class="text-[9px] text-gray-500 uppercase font-black mb-1">Growth</p><div id="growthVal" class="text-4xl font-black text-white italic">0</div></div>
                                </div>
                                <div id="statsGrids" class="grid grid-cols-3 gap-4">
                                    </div>
                                <div class="glass-card p-8 border-2 border-yellow-500/10 bg-gradient-to-br from-yellow-500/5 to-transparent">
                                    <h4 class="text-xs font-black text-white uppercase italic mb-4 tracking-widest">Strategic Roadmap 2026</h4>
                                    <p id="summerText" class="text-xs text-gray-400 italic leading-relaxed"></p>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="flex justify-center">
                        <button id="downloadBtn" class="bg-gradient-to-r from-yellow-600 to-yellow-400 text-black font-black px-16 py-5 rounded-full text-[10px] uppercase tracking-[0.3em] hover:scale-105 transition shadow-2xl">Export Performance Dossier</button>
                    </div>
                </div>
            </main>

            <aside class="lg:col-span-4">
                <div class="glass-card p-8 sticky top-8">
                    <div class="flex flex-col items-center text-center pb-8 border-b border-white/5">
                        <div id="user-initials" class="w-20 h-20 rounded-3xl bg-gradient-to-br from-yellow-500 to-yellow-700 flex items-center justify-center text-3xl font-black text-black shadow-lg mb-6 uppercase">??</div>
                        <h4 id="user-name" class="text-xl font-black text-white uppercase italic tracking-tight">Laden...</h4>
                        <p id="user-role-display" class="text-[10px] text-yellow-500 font-bold uppercase tracking-[0.2em] mt-1 italic">Authorized Coach</p>
                    </div>
                    <div class="pt-8 space-y-3">
                        <div id="adminLink" class="hidden">
                            <a href="admin_panel.html" class="flex items-center justify-between p-4 rounded-2xl bg-purple-500/5 border border-purple-500/10 text-purple-400 hover:bg-purple-500/10 transition">
                                <span class="text-[10px] font-black uppercase tracking-widest">Admin Control</span>
                                <span>üõ†Ô∏è</span>
                            </a>
                        </div>
                        <button onclick="sessionStorage.clear(); window.location.href='login.html';" class="w-full flex items-center justify-between p-4 rounded-2xl bg-red-500/5 border border-red-500/10 text-red-500 hover:bg-red-500/10 transition">
                            <span class="text-[10px] font-black uppercase tracking-widest">Terminate Session</span>
                            <span>üîí</span>
                        </button>
                    </div>
                </div>
            </aside>
        </div>
    </div>

    <script type="module">
        import DataProvider from './js/data_provider.js';

        const sessionUser = sessionStorage.getItem('elite_user');
        if (!sessionUser) window.location.href = 'login.html';
        const currentUser = JSON.parse(sessionUser);

        let chartTrend = null, filteredPlayers = [];

        async function init() {
            const allPlayers = await DataProvider.getAllPlayers();
            if(!allPlayers.length) return;

            document.getElementById('user-name').innerText = currentUser.name;
            document.getElementById('user-role-display').innerText = currentUser.role;
            document.getElementById('user-initials').innerText = currentUser.name.split(' ').map(n => n[0]).join('');
            
            if (currentUser.role === 'admin') {
                document.getElementById('adminLink').classList.remove('hidden');
                filteredPlayers = allPlayers;
                document.getElementById('stat-team-display').innerText = "HQ COMMAND";
            } else {
                filteredPlayers = allPlayers.filter(p => currentUser.teams.includes(p.bio.team));
                document.getElementById('stat-team-display').innerText = currentUser.teams[0] || "SELECTIE";
            }

            document.getElementById('stat-total-display').innerText = filteredPlayers.length;
            document.getElementById('stat-avg-display').innerText = "77%";

            const selector = document.getElementById('playerSelector');
            selector.innerHTML = '<option value="">SELECTEER ASSET...</option>' + 
                filteredPlayers.map(p => `<option value="${p.id}">${p.bio.name}</option>`).join('');

            selector.addEventListener('change', e => {
                if(e.target.value) {
                    document.getElementById('welcomeScreen').classList.add('hidden');
                    document.getElementById('playerDossier').classList.remove('hidden');
                    update(e.target.value);
                }
            });
        }

        const update = (id) => {
            const p = filteredPlayers.find(x => x.id === id);
            if(!p) return;
            document.getElementById('pName').innerText = p.bio.name;
            document.getElementById('pPhoto').src = p.bio.photo;
            document.getElementById('pMeta').innerText = `${p.bio.team} ‚Ä¢ Intelligence Class A`;
            document.getElementById('finalScore').innerText = 77;
            document.getElementById('attScore').innerText = (p.obj?.attendance || 0) + "%";
            document.getElementById('growthVal').innerText = "+8";
            document.getElementById('summerText').innerText = "De data suggereert een intensief focus-traject op explosieve versnelling en tactisch spelinzicht. Gezien de huidige Elite Index van 77% is een stijging naar 85% haalbaar door de roadmap strikt te volgen.";

            renderTrend();
        };

        const renderTrend = () => {
            const ctx = document.getElementById('trendChart');
            if(chartTrend) chartTrend.destroy();
            chartTrend = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ["Q1", "Q2", "Q3", "Q4"],
                    datasets: [{ 
                        data: [65, 72, 70, 77], 
                        borderColor: '#D4AF37', 
                        tension: 0.4, 
                        fill: true, 
                        backgroundColor: 'rgba(212,175,55,0.05)',
                        pointRadius: 0
                    }]
                },
                options: { 
                    scales: { 
                        y: { display: false }, 
                        x: { grid: { display: false }, ticks: { color: '#444', font: { size: 8 } } } 
                    }, 
                    plugins: { legend: { display: false } } 
                }
            });
        };

        init();
    </script>
</body>
</html>
