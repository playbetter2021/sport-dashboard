<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <title>Elite Pro | Intelligence Mission Control</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        :root { --gold: #D4AF37; --obsidian: #0a0a0a; }
        body { background-color: var(--obsidian); color: #e5e5e5; font-family: 'Inter', sans-serif; overflow-x: hidden; }
        .gold-gradient { background: linear-gradient(135deg, #D4AF37 0%, #F9E272 50%, #B8860B 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .glass-card { background: rgba(255, 255, 255, 0.02); border: 1px solid rgba(212, 175, 55, 0.15); border-radius: 1.5rem; transition: all 0.3s ease; }
        .skill-bar { height: 6px; background: rgba(255,255,255,0.05); border-radius: 3px; overflow: hidden; }
        .skill-fill { height: 100%; background: linear-gradient(90deg, #B8860B, #D4AF37); transition: width 1.5s cubic-bezier(0.1, 0, 0, 1); }
        .status-badge { background: rgba(212, 175, 55, 0.1); border: 1px solid var(--gold); color: var(--gold); padding: 4px 12px; border-radius: 20px; font-size: 10px; font-weight: 800; text-transform: uppercase; }
        .welcome-animate { animation: fadeInScale 0.8s ease-out; }
        @keyframes fadeInScale { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: scale(1); } }
    </style>
</head>
<body class="p-4 md:p-8">
    <div class="max-w-[1600px] mx-auto space-y-8">
        
        <header class="flex flex-col lg:flex-row justify-between items-center gap-6 border-b border-white/5 pb-8">
            <div>
                <h1 class="text-4xl font-black italic gold-gradient uppercase tracking-tighter leading-none">Elite<span class="text-white not-italic">Intelligence</span></h1>
                <p class="text-[10px] text-gray-500 uppercase font-bold tracking-[0.4em] mt-2">Season 2025-2026 ‚Ä¢ Intelligence Division</p>
            </div>
            
            <div class="flex items-center gap-4 w-full lg:w-auto">
                <div class="relative w-full lg:w-96 group">
                    <span class="absolute left-5 top-1/2 -translate-y-1/2 text-yellow-500 opacity-50 group-focus-within:opacity-100 transition">üîç</span>
                    <select id="playerSelector" class="w-full bg-white/5 border border-yellow-700/30 text-white py-4 px-12 rounded-2xl text-xs font-black outline-none appearance-none cursor-pointer focus:border-yellow-500 transition shadow-2xl">
                        </select>
                </div>
            </div>
        </header>

        <section class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
            <div class="glass-card p-6 relative overflow-hidden group hover:bg-white/[0.04]">
                <div class="absolute top-0 left-0 w-1 h-full bg-yellow-500"></div>
                <p class="text-[9px] uppercase font-black text-gray-500 tracking-widest mb-1">Active Assignment</p>
                <p class="text-2xl font-black text-white italic" id="stat-team-display">Laden...</p>
                <span class="absolute right-6 top-1/2 -translate-y-1/2 text-3xl opacity-10">üõ°Ô∏è</span>
            </div>
            
            <div class="glass-card p-6 relative overflow-hidden group hover:bg-white/[0.04]">
                <div class="absolute top-0 left-0 w-1 h-full bg-blue-500"></div>
                <p class="text-[9px] uppercase font-black text-gray-500 tracking-widest mb-1">Total Assets</p>
                <p class="text-2xl font-black text-white italic" id="stat-total-display">--</p>
                <span class="absolute right-6 top-1/2 -translate-y-1/2 text-3xl opacity-10">üë•</span>
            </div>

            <div class="glass-card p-6 relative overflow-hidden group hover:bg-white/[0.04]">
                <div class="absolute top-0 left-0 w-1 h-full bg-green-500"></div>
                <p class="text-[9px] uppercase font-black text-gray-500 tracking-widest mb-1">Elite Team Index</p>
                <p class="text-2xl font-black text-white italic" id="stat-avg-display">--</p>
                <span class="absolute right-6 top-1/2 -translate-y-1/2 text-3xl opacity-10">üìà</span>
            </div>

            <div class="glass-card p-6 relative overflow-hidden group hover:bg-white/[0.04]">
                <div class="absolute top-0 left-0 w-1 h-full bg-purple-500"></div>
                <p class="text-[9px] uppercase font-black text-gray-500 tracking-widest mb-1">Network Status</p>
                <div class="flex items-center gap-3">
                    <p class="text-2xl font-black text-green-500 italic uppercase">Secure</p>
                    <span class="w-3 h-3 bg-green-500 rounded-full animate-pulse"></span>
                </div>
            </div>
        </section>

        <div class="grid grid-cols-1 lg:grid-cols-12 gap-8">
            
            <main class="lg:col-span-8 space-y-8">
                
                <div id="navigationCore" class="space-y-4">
                    <h3 class="text-[10px] font-black uppercase text-gray-500 tracking-[0.4em] ml-2 italic">Primary Operations</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <a href="planner.html" class="glass-card p-8 group border-b-4 border-blue-600 hover:translate-y-[-4px]">
                            <div class="flex justify-between items-start mb-6">
                                <span class="text-5xl group-hover:scale-110 transition duration-500">üìÖ</span>
                                <span class="text-[10px] font-black bg-blue-600/20 text-blue-400 px-3 py-1 rounded-full uppercase">Tactical</span>
                            </div>
                            <h4 class="text-xl font-black text-white uppercase italic tracking-tighter">Trainings Planner</h4>
                            <p class="text-xs text-gray-500 mt-2">Stel sessies samen en beheer de seizoensagenda.</p>
                        </a>

                        <a href="coach.html" class="glass-card p-8 group border-b-4 border-purple-600 hover:translate-y-[-4px]">
                            <div class="flex justify-between items-start mb-6">
                                <span class="text-5xl group-hover:scale-110 transition duration-500">üß†</span>
                                <span class="text-[10px] font-black bg-purple-600/20 text-purple-400 px-3 py-1 rounded-full uppercase">Intelligence</span>
                            </div>
                            <h4 class="text-xl font-black text-white uppercase italic tracking-tighter">Coach Ratings</h4>
                            <p class="text-xs text-gray-500 mt-2">Verwerk spelerbeoordelingen direct na de actie.</p>
                        </a>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 pt-4">
                        <a href="overview.html" class="glass-card p-6 flex flex-col items-center text-center hover:bg-white/5 group">
                            <span class="text-3xl mb-3 group-hover:rotate-12 transition">üìã</span>
                            <span class="text-[10px] font-black uppercase text-white tracking-widest">Squad Archive</span>
                        </a>
                        <a href="comparison.html" class="glass-card p-6 flex flex-col items-center text-center hover:bg-white/5 group">
                            <span class="text-3xl mb-3 group-hover:rotate-12 transition">‚öñÔ∏è</span>
                            <span class="text-[10px] font-black uppercase text-white tracking-widest">Selection Matrix</span>
                        </a>
                        <a href="seasonal_analysis.html" class="glass-card p-6 flex flex-col items-center text-center hover:bg-white/5 group">
                            <span class="text-3xl mb-3 group-hover:rotate-12 transition">üìä</span>
                            <span class="text-[10px] font-black uppercase text-white tracking-widest">Analysis</span>
                        </a>
                    </div>
                </div>

                <div id="playerDossier" class="hidden welcome-animate">
                    <div id="captureArea" class="bg-[#0a0a0a] p-8 rounded-[3rem] border border-white/10 shadow-2xl">
                        <div class="grid grid-cols-1 xl:grid-cols-12 gap-8">
                            <div class="xl:col-span-4 space-y-6">
                                <div class="glass-card overflow-hidden relative group">
                                    <img id="pPhoto" class="w-full h-[450px] object-cover bg-neutral-900 transition duration-700 group-hover:scale-110" src="" crossorigin="anonymous">
                                    <div class="absolute inset-0 bg-gradient-to-t from-black via-transparent to-transparent"></div>
                                    <div class="absolute bottom-8 left-8">
                                        <div id="pAllocation" class="status-badge mb-4 inline-block">Berekent...</div>
                                        <h2 id="pName" class="text-4xl font-black uppercase italic text-white leading-none tracking-tighter"></h2>
                                        <p id="pMeta" class="text-gray-400 text-[10px] font-bold mt-3 uppercase tracking-[0.3em]"></p>
                                    </div>
                                </div>
                                <div class="glass-card p-6">
                                    <canvas id="trendChart" height="150"></canvas>
                                </div>
                                <div class="glass-card p-8 flex flex-col items-center">
                                    <canvas id="radarChart"></canvas>
                                </div>
                            </div>

                            <div class="xl:col-span-8 space-y-6">
                                <div class="grid grid-cols-2 lg:grid-cols-4 gap-4">
                                    <div class="glass-card p-6 text-center border-b-4 border-yellow-600">
                                        <p class="text-[10px] text-gray-500 uppercase font-black mb-1">Index</p>
                                        <div id="finalScore" class="text-4xl font-black text-white italic">0</div>
                                    </div>
                                    <div class="glass-card p-6 text-center border-b-4 border-blue-500">
                                        <p class="text-[10px] text-gray-500 uppercase font-black mb-1">Opkomst</p>
                                        <div id="attScore" class="text-4xl font-black text-white italic">0%</div>
                                    </div>
                                    <div class="glass-card p-6 text-center border-b-4 border-green-500">
                                        <p class="text-[10px] text-gray-500 uppercase font-black mb-1">Minuten</p>
                                        <div id="minScore" class="text-4xl font-black text-white italic">0</div>
                                    </div>
                                    <div class="glass-card p-6 text-center border-b-4 border-purple-500">
                                        <p class="text-[10px] text-gray-500 uppercase font-black mb-1">Growth</p>
                                        <div id="growthVal" class="text-4xl font-black text-white italic">0</div>
                                    </div>
                                </div>
                                <div class="grid grid-cols-1 lg:grid-cols-3 gap-4">
                                    <div class="glass-card p-6"><h4 class="text-[10px] font-black text-yellow-500 uppercase mb-4">Technical</h4><div id="techGrid" class="space-y-4"></div></div>
                                    <div class="glass-card p-6"><h4 class="text-[10px] font-black text-blue-500 uppercase mb-4">Tactical</h4><div id="physGrid" class="space-y-4"></div></div>
                                    <div class="glass-card p-6"><h4 class="text-[10px] font-black text-purple-500 uppercase mb-4">Mental</h4><div id="mentGrid" class="space-y-4"></div></div>
                                </div>
                                <div class="glass-card p-8 border-2 border-yellow-600/30 bg-gradient-to-br from-yellow-600/5 to-transparent">
                                    <h3 class="text-xl font-black text-white uppercase mb-4 italic tracking-tighter">Summer Roadmap 2026</h3>
                                    <div class="grid grid-cols-1 lg:grid-cols-12 gap-6 items-center">
                                        <div class="lg:col-span-4 bg-black/40 p-6 rounded-2xl border border-white/10 text-center">
                                            <label class="text-[9px] font-black text-yellow-500 uppercase mb-2 block">Target Skill</label>
                                            <p id="focusSkill" class="text-2xl font-black text-white uppercase italic tracking-tighter">-</p>
                                        </div>
                                        <div class="lg:col-span-8">
                                            <p id="summerText" class="text-xs text-gray-400 italic leading-relaxed"></p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="mt-8 flex justify-center pb-10">
                        <button id="downloadBtn" class="bg-gradient-to-r from-yellow-600 to-yellow-400 text-black font-black px-12 py-4 rounded-full text-[10px] uppercase tracking-[0.2em] hover:scale-105 transition shadow-2xl">Export Performance Report</button>
                    </div>
                </div>

                <div id="welcomeScreen" class="welcome-animate pt-10">
                    <div class="glass-card p-12 border-2 border-yellow-600/10 text-center">
                        <h2 class="text-4xl font-black italic text-white uppercase mb-4 tracking-tighter">Status: <span class="text-yellow-500">Standby</span></h2>
                        <p class="text-gray-500 text-sm max-w-md mx-auto italic">Selecteer een asset in de terminal om de volledige dataset te laden.</p>
                    </div>
                </div>
            </main>

            <aside class="lg:col-span-4 space-y-6">
                <h3 class="text-[10px] font-black uppercase text-gray-500 tracking-[0.4em] ml-2 italic">Identity & Security</h3>
                <div class="glass-card p-8 sticky top-8">
                    <div class="flex flex-col items-center text-center pb-8 border-b border-white/5">
                        <div id="user-initials" class="w-20 h-20 rounded-3xl bg-gradient-to-br from-yellow-500 to-yellow-700 flex items-center justify-center text-2xl font-black text-black shadow-lg mb-4 uppercase">??</div>
                        <h4 id="user-name" class="text-xl font-black text-white uppercase italic tracking-tight">Laden...</h4>
                        <p id="user-role-display" class="text-[10px] text-yellow-500 font-bold uppercase tracking-widest mt-1">Verification...</p>
                    </div>
                    <div class="pt-8 space-y-3">
                        <div id="adminLink" class="hidden">
                            <a href="admin_panel.html" class="flex items-center justify-between p-4 rounded-2xl bg-purple-500/5 border border-purple-500/20 text-purple-400 hover:bg-purple-500/10 transition group">
                                <span class="text-[10px] font-black uppercase tracking-widest">Admin Control</span>
                                <span>üõ†Ô∏è</span>
                            </a>
                        </div>
                        <button onclick="sessionStorage.clear(); window.location.href='login.html';" class="w-full flex items-center justify-between p-4 rounded-2xl bg-red-500/5 border border-red-500/20 text-red-500 hover:bg-red-500/10 transition">
                            <span class="text-[10px] font-black uppercase tracking-widest">Terminate Session</span>
                            <span>üîí</span>
                        </button>
                    </div>
                </div>
            </aside>
        </div>
    </div>

    

    <script type="module">
        import DataProvider from './js/data_provider.js';

        const sessionUser = sessionStorage.getItem('elite_user');
        if (!sessionUser) window.location.href = 'login.html';
        const currentUser = JSON.parse(sessionUser);

        let chartRadar = null, chartTrend = null, filteredPlayers = [];

        const calcIndex = (p) => {
            if(!p.obj || !p.ratings) return 0;
            const obj = Math.round((p.obj.attendance * 0.4) + ((p.obj.minutes / 1500) * 100 * 0.6));
            const coach = Math.round((Object.values(p.ratings).reduce((a,b)=>parseInt(a)+parseInt(b),0)/(Object.keys(p.ratings).length*5))*100);
            const tech = p.stats?.Techniek || 50;
            return Math.round((obj * 0.65) + (tech * 0.20) + (coach * 0.15));
        };

        async function init() {
            const allPlayers = await DataProvider.getAllPlayers();
            if(!allPlayers.length) return;

            document.getElementById('user-name').innerText = currentUser.name;
            document.getElementById('user-role-display').innerText = currentUser.role;
            document.getElementById('user-initials').innerText = currentUser.name.split(' ').map(n => n[0]).join('');
            
            if (currentUser.role === 'admin') {
                document.getElementById('adminLink').classList.remove('hidden');
                filteredPlayers = allPlayers;
                document.getElementById('stat-team-display').innerText = "ALLE TEAMS";
            } else {
                filteredPlayers = allPlayers.filter(p => currentUser.teams.includes(p.bio.team));
                document.getElementById('stat-team-display').innerText = currentUser.teams[0] || "GEEN TEAM";
            }

            const totalCount = filteredPlayers.length;
            document.getElementById('stat-total-display').innerText = totalCount;
            const avgVal = totalCount > 0 ? Math.round(filteredPlayers.reduce((acc, p) => acc + calcIndex(p), 0) / totalCount) : 0;
            document.getElementById('stat-avg-display').innerText = avgVal + "%";

            const selector = document.getElementById('playerSelector');
            selector.innerHTML = '<option value="">SELECTEER ASSET...</option>' + 
                filteredPlayers.map(p => `<option value="${p.id}">${p.bio.name}</option>`).join('');

            selector.addEventListener('change', e => {
                if(e.target.value) {
                    document.getElementById('welcomeScreen').classList.add('hidden');
                    document.getElementById('playerDossier').classList.remove('hidden');
                    update(e.target.value);
                }
            });
        }

        const update = (id) => {
            const p = filteredPlayers.find(x => x.id === id);
            if(!p) return;
            document.getElementById('pName').innerText = p.bio.name;
            document.getElementById('pPhoto').src = p.bio.photo;
            document.getElementById('pMeta').innerText = `${p.bio.team} | ${p.bio.role}`;
            
            const idx = calcIndex(p);
            document.getElementById('finalScore').innerText = idx;
            document.getElementById('attScore').innerText = (p.obj?.attendance || 0) + "%";
            document.getElementById('minScore').innerText = (p.obj?.minutes || 0);

            const r = p.ratings || {};
            const bar = (l, v) => `<div class="space-y-1"><div class="flex justify-between text-[8px] font-black uppercase"><span class="text-gray-500">${l}</span><span class="text-white">${v}/5</span></div><div class="skill-bar"><div class="skill-fill" style="width:${(v/5)*100}%"></div></div></div>`;
            
            document.getElementById('techGrid').innerHTML = bar("Balcontrole", r.bal) + bar("Passing", r.pas) + bar("Aanname", r.aan) + bar("Dribbel", r.drib);
            document.getElementById('physGrid').innerHTML = bar("Snelheid", r.sne) + bar("Kracht", r.kra) + bar("Uithouding", r.uit) + bar("Inzicht", r.posi);
            document.getElementById('mentGrid').innerHTML = bar("Inzet", r.inz) + bar("Focus", r.mot) + bar("Coaching", r.coa) + bar("Team", r.tea);

            const sm = { bal:"Balcontrole", pas:"Passing", aan:"Aanname", drib:"Dribbel", sne:"Snelheid", uit:"Conditie", posi:"Inzicht" };
            let lowK = "bal", lowV = 6;
            ['bal','pas','aan','drib','sne','uit','posi'].forEach(k => { if(r[k] < lowV) { lowV = r[k]; lowK = k; } });
            
            document.getElementById('focusSkill').innerText = sm[lowK];
            document.getElementById('summerText').innerText = `Analyse wijst uit dat ${sm[lowK]} momenteel de limiterende factor is. Door hier in de zomerstop specifiek op te trainen, kan de Elite Index significant stijgen naar een geprojecteerde ${idx + 6}%.`;

            renderRadar(p);
            renderTrend(p);
        };

        const renderRadar = (p) => {
            const ctx = document.getElementById('radarChart');
            if(chartRadar) chartRadar.destroy();
            chartRadar = new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: ['Techniek', 'Tactiek', 'Fysiek', 'Mentaal'],
                    datasets: [{ data: Object.values(p.stats), borderColor: '#D4AF37', backgroundColor: 'rgba(212,175,55,0.2)', borderWidth: 2, pointRadius: 0 }]
                },
                options: { scales: { r: { suggestedMin: 0, suggestedMax: 100, ticks: {display:false}, grid: {color:'rgba(255,255,255,0.05)'} } }, plugins: { legend: { display: false } } }
            });
        };

        const renderTrend = (p) => {
            const ctx = document.getElementById('trendChart');
            if(chartTrend) chartTrend.destroy();
            chartTrend = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ["Start", "Winter", "Eind"],
                    datasets: [{ data: [62, 70, calcIndex(p)], borderColor: '#D4AF37', tension: 0.4, fill: true, backgroundColor: 'rgba(212,175,55,0.05)' }]
                },
                options: { scales: { y: { display: false }, x: { grid: { display: false }, ticks: { color: '#444', font: { size: 8 } } } }, plugins: { legend: { display: false } } }
            });
        };

        document.getElementById('downloadBtn').onclick = async () => {
            const area = document.getElementById('captureArea');
            const canvas = await html2canvas(area, { backgroundColor: '#0a0a0a', scale: 2 });
            const imgData = canvas.toDataURL('image/png');
            const pdf = new jspdf.jsPDF('l', 'mm', 'a4');
            pdf.addImage(imgData, 'PNG', 10, 10, 277, 190);
            pdf.save(`Elite_Dossier_${document.getElementById('pName').innerText}.pdf`);
        };

        init();
    </script>
</body>
</html>
