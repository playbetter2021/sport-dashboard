<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <title>Elite Pro | Mission Control</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
    
    <style>
        /* --- ELITE ENTERPRISE DESIGN SYSTEM (Consistent met Coach/Compare) --- */
        :root {
            --bg-body: #09090b;       
            --bg-surface: #121215;    
            --bg-panel: #18181b;      
            --bg-element: #27272a;    
            --border-subtle: #27272a;
            --border-strong: #3f3f46;
            --text-primary: #f4f4f5;  
            --text-secondary: #a1a1aa; 
            --text-tertiary: #52525b;  
            --accent: #D4AF37;        
            --accent-glow: rgba(212, 175, 55, 0.15);
            --danger: #ef4444;
            --success: #10b981;
            --font-main: 'Inter', sans-serif;
            --font-mono: 'JetBrains Mono', monospace;
        }

        body {
            background-color: var(--bg-body);
            color: var(--text-primary);
            font-family: var(--font-main);
            height: 100vh;
            overflow: hidden;
            display: flex;
            margin: 0;
        }

        /* --- SIDEBAR --- */
        aside {
            width: 280px;
            background: var(--bg-surface);
            border-right: 1px solid var(--border-subtle);
            display: flex;
            flex-direction: column;
            height: 100%;
            z-index: 20;
        }

        .brand-area { padding: 24px; border-bottom: 1px solid var(--border-subtle); display: flex; align-items: center; gap: 12px; }
        .logo-mark { width: 32px; height: 32px; background: linear-gradient(135deg, var(--accent), #b8860b); border-radius: 8px; display: flex; align-items: center; justify-content: center; font-weight: 900; color: #000; font-size: 14px; box-shadow: 0 0 15px var(--accent-glow); }
        .brand-text { font-weight: 700; font-size: 16px; letter-spacing: -0.5px; }
        .brand-text span { color: var(--accent); }

        .nav-section { padding: 24px; flex: 1; display: flex; flex-direction: column; gap: 4px; }
        .nav-item { padding: 12px 24px; color: var(--text-secondary); cursor: pointer; display: flex; align-items: center; gap: 12px; font-size: 13px; font-weight: 500; transition: 0.2s; border-radius: 6px; }
        .nav-item:hover { background: var(--bg-element); color: white; }
        .nav-item.active { background: var(--bg-element); color: white; border-left: 2px solid var(--accent); border-radius: 0 6px 6px 0; }
        
        .system-footer { padding: 16px 24px; border-top: 1px solid var(--border-subtle); background: #0c0c0e; font-size: 11px; color: var(--text-tertiary); }

        /* --- MAIN CONTENT --- */
        main {
            flex: 1;
            position: relative;
            overflow-y: auto;
            background: radial-gradient(circle at top right, rgba(212,175,55,0.05), transparent 50%), var(--bg-body);
        }

        /* Header */
        .glass-header {
            position: sticky; top: 0; z-index: 50;
            background: rgba(9, 9, 11, 0.8);
            backdrop-filter: blur(12px);
            border-bottom: 1px solid var(--border-subtle);
            padding: 16px 32px;
            display: flex; justify-content: space-between; align-items: center;
        }

        .content-wrapper { padding: 32px; max-width: 1400px; margin: 0 auto; }

        /* KPI Cards */
        .kpi-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 24px; margin-bottom: 32px; }
        .kpi-card {
            background: var(--bg-panel); border: 1px solid var(--border-subtle); border-radius: 12px; padding: 20px;
            position: relative; overflow: hidden;
        }
        .kpi-card::before { content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 2px; background: linear-gradient(90deg, var(--bg-panel), var(--accent), var(--bg-panel)); opacity: 0; transition: 0.3s; }
        .kpi-card:hover::before { opacity: 1; }
        .kpi-label { font-size: 11px; font-weight: 600; color: var(--text-tertiary); text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 8px; }
        .kpi-value { font-size: 28px; font-weight: 700; color: white; font-family: var(--font-mono); }
        .kpi-trend { font-size: 11px; margin-top: 4px; display: flex; align-items: center; gap: 4px; }
        .trend-up { color: var(--success); }
        .trend-neutral { color: var(--text-tertiary); }

        /* Module Cards (Big Links) */
        .module-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 24px; margin-bottom: 32px; }
        .module-card {
            background: linear-gradient(145deg, var(--bg-panel), var(--bg-surface));
            border: 1px solid var(--border-subtle); border-radius: 16px; padding: 32px;
            display: flex; justify-content: space-between; items-center;
            cursor: pointer; transition: all 0.3s ease; position: relative;
        }
        .module-card:hover { transform: translateY(-2px); border-color: var(--border-strong); box-shadow: 0 10px 30px -10px rgba(0,0,0,0.5); }
        .module-card:hover .module-icon { color: var(--accent); transform: scale(1.1); }
        
        .module-info h3 { font-size: 18px; font-weight: 700; color: white; margin-bottom: 4px; }
        .module-info p { font-size: 12px; color: var(--text-secondary); max-width: 250px; }
        .module-icon { font-size: 40px; color: var(--text-tertiary); transition: 0.3s; }

        /* Dashboard Bottom (Charts & Lists) */
        .dash-split { display: grid; grid-template-columns: 2fr 1fr; gap: 24px; }
        
        .panel { background: var(--bg-panel); border: 1px solid var(--border-subtle); border-radius: 12px; padding: 24px; display: flex; flex-direction: column; }
        .panel-title { font-size: 13px; font-weight: 700; color: white; margin-bottom: 20px; display: flex; justify-content: space-between; align-items: center; }

        /* Activity List */
        .activity-item { display: flex; align-items: center; gap: 12px; padding: 12px 0; border-bottom: 1px solid var(--border-subtle); }
        .activity-item:last-child { border-bottom: none; }
        .activity-avatar { width: 32px; height: 32px; border-radius: 6px; background: #000; object-fit: cover; }
        .activity-content { flex: 1; }
        .activity-text { font-size: 12px; color: var(--text-primary); }
        .activity-meta { font-size: 10px; color: var(--text-tertiary); }
        .status-badge { font-size: 10px; padding: 2px 6px; border-radius: 4px; font-weight: 700; text-transform: uppercase; }
        .badge-locked { background: rgba(16, 185, 129, 0.1); color: var(--success); }
        .badge-draft { background: rgba(255, 165, 0, 0.1); color: orange; }

    </style>
</head>
<body>

    <aside>
        <div class="brand-area">
            <div class="logo-mark">EP</div>
            <div class="brand-text">ELITE<span>PRO</span></div>
        </div>

        <div class="nav-section">
            <div class="nav-item active">
                <span>üè†</span> Mission Control
            </div>
            <div class="nav-item" onclick="window.location.href='coach.html'">
                <span>üìä</span> Coach Dashboard
            </div>
            <div class="nav-item" onclick="window.location.href='comparison.html'">
                <span>‚öñÔ∏è</span> Intelligence Matrix
            </div>
            <div class="mt-8 text-[10px] uppercase font-bold text-gray-600 px-6 mb-2 tracking-widest">Settings</div>
            <div class="nav-item">
                <span>‚öôÔ∏è</span> Systeem Config
            </div>
        </div>

        <div class="system-footer">
            <div class="flex items-center gap-2 mb-2">
                <div class="w-2 h-2 rounded-full bg-green-500"></div>
                <span>System Online</span>
            </div>
            <div>v2.5.0 (Enterprise)</div>
        </div>
    </aside>

    <main>
        <header class="glass-header">
            <div class="flex flex-col">
                <h1 class="text-sm font-bold text-white uppercase tracking-wider">Mission Control</h1>
                <span class="text-xs text-gray-500">Welkom terug, Hoofd Opleiding</span>
            </div>
            <div class="flex items-center gap-4">
                <div class="text-right hidden md:block">
                    <div class="text-xs font-bold text-white" id="currentDate">--</div>
                    <div class="text-[10px] text-gray-500">Last Sync: Just now</div>
                </div>
                <div class="w-8 h-8 rounded bg-yellow-600 flex items-center justify-center text-xs font-bold text-black">HO</div>
            </div>
        </header>

        <div class="content-wrapper">
            
            <div class="kpi-grid">
                <div class="kpi-card">
                    <div class="kpi-label">Totale Selectie</div>
                    <div class="kpi-value" id="kpiTotal">0</div>
                    <div class="kpi-trend trend-neutral">Actieve Spelers</div>
                </div>
                <div class="kpi-card">
                    <div class="kpi-label">Dossiers Compleet</div>
                    <div class="kpi-value" id="kpiLocked">0</div>
                    <div class="kpi-trend trend-up">‚Üë Klaar voor export</div>
                </div>
                <div class="kpi-card">
                    <div class="kpi-label">In Concept</div>
                    <div class="kpi-value" id="kpiDraft" style="color: orange;">0</div>
                    <div class="kpi-trend trend-neutral">Vereist actie</div>
                </div>
                <div class="kpi-card">
                    <div class="kpi-label">Team Performance</div>
                    <div class="kpi-value" id="kpiAvg">0.0</div>
                    <div class="kpi-trend trend-up" style="color: var(--accent);">Gemiddelde Index</div>
                </div>
            </div>

            <div class="module-grid">
                <div class="module-card" onclick="window.location.href='coach.html'">
                    <div class="module-info">
                        <h3>Coach Dashboard</h3>
                        <p>Beheer individuele dossiers, technische analyses en POP-gesprekken.</p>
                    </div>
                    <div class="module-icon">üìä</div>
                </div>
                <div class="module-card" onclick="window.location.href='comparison.html'">
                    <div class="module-info">
                        <h3>Intelligence Matrix</h3>
                        <p>Vergelijk spelers head-to-head en analyseer data voor promotie.</p>
                    </div>
                    <div class="module-icon">‚öñÔ∏è</div>
                </div>
            </div>

            <div class="dash-split">
                <div class="panel">
                    <div class="panel-title">
                        Performance Distributie
                        <select class="bg-black border border-white/10 text-[10px] rounded px-2 py-1 outline-none text-gray-400">
                            <option>Huidig Seizoen</option>
                        </select>
                    </div>
                    <div class="flex-1 w-full h-64 relative">
                        <canvas id="teamChart"></canvas>
                    </div>
                </div>

                <div class="panel">
                    <div class="panel-title">Recente Activiteit</div>
                    <div id="activityList" class="flex flex-col h-64 overflow-y-auto pr-2">
                        <div class="text-xs text-gray-500 italic text-center mt-10">Laden...</div>
                    </div>
                </div>
            </div>

        </div>
    </main>

    <script type="module">
        import DataProvider from './js/data_provider.js';

        async function initDashboard() {
            // Set Date
            const now = new Date();
            document.getElementById('currentDate').innerText = now.toLocaleDateString('nl-NL', { weekday: 'long', day: 'numeric', month: 'long' });

            // Fetch Data
            const players = await DataProvider.getAllPlayers();
            
            // KPI Calculations (Mock logic based on 'history')
            const total = players.length;
            let locked = 0;
            let draft = 0;
            let totalScore = 0;
            let scoreCount = 0;

            const recentUpdates = [];

            players.forEach(p => {
                // Check status in latest period (mock: '1e seizoenshelft')
                const history = p.history?.['1e seizoenshelft'];
                if(history) {
                    if(history.status === 'locked') locked++;
                    if(history.status === 'draft') draft++;
                    
                    // Calc average rating
                    if(history.ratings) {
                        const ratings = Object.values(history.ratings);
                        const avg = ratings.reduce((a,b)=>a+b,0) / ratings.length;
                        totalScore += avg;
                        scoreCount++;
                    }

                    // Push to recent if updated recently (Mock: we just take those with history)
                    recentUpdates.push({
                        name: p.bio.name,
                        team: p.bio.team,
                        status: history.status,
                        time: new Date(history.lastUpdated || Date.now()).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'}),
                        photo: p.bio.photo
                    });
                }
            });

            // Update DOM KPIs
            document.getElementById('kpiTotal').innerText = total;
            document.getElementById('kpiLocked').innerText = locked;
            document.getElementById('kpiDraft').innerText = draft;
            document.getElementById('kpiAvg').innerText = scoreCount > 0 ? (totalScore / scoreCount).toFixed(1) : "0.0";

            // Update Activity List
            const activityContainer = document.getElementById('activityList');
            if(recentUpdates.length > 0) {
                activityContainer.innerHTML = recentUpdates.slice(0, 5).map(item => `
                    <div class="activity-item">
                        <img src="${item.photo || 'https://via.placeholder.com/32'}" class="activity-avatar">
                        <div class="activity-content">
                            <div class="activity-text font-bold text-white">${item.name}</div>
                            <div class="activity-meta">${item.team} ‚Ä¢ ${item.time}</div>
                        </div>
                        <span class="status-badge ${item.status === 'locked' ? 'badge-locked' : 'badge-draft'}">
                            ${item.status === 'locked' ? 'DONE' : 'WIP'}
                        </span>
                    </div>
                `).join('');
            } else {
                activityContainer.innerHTML = '<div class="text-xs text-gray-500 text-center mt-4">Geen recente wijzigingen gevonden.</div>';
            }

            // Render Chart
            const ctx = document.getElementById('teamChart').getContext('2d');
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['O13', 'O14', 'O15', 'O16', 'O17', 'O18'],
                    datasets: [{
                        label: 'Gemiddelde Index',
                        data: [6.5, 7.2, 6.8, 7.5, 7.1, 8.0], // Mock data, replace with real calc if needed
                        backgroundColor: '#D4AF37',
                        borderRadius: 4
                    }, {
                        label: 'Target',
                        data: [7, 7, 7.5, 7.5, 8, 8],
                        type: 'line',
                        borderColor: '#52525b',
                        borderDash: [5, 5],
                        pointRadius: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: {
                        y: { beginAtZero: true, max: 10, grid: { color: '#27272a' } },
                        x: { grid: { display: false } }
                    }
                }
            });
        }

        initDashboard();
    </script>
</body>
</html>
